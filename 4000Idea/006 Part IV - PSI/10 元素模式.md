# 元素模式

&emsp;&emsp;元素模式提供了一种通用的方式来指定对象的条件。

&emsp;&emsp;插件作者使用它们来检查PSI元素是否与一个特定的结构相匹配。就像字符串的正则表达式测试一个（子）字符串是否与一个特定的模式相匹配一样，元素模式被用来对PSI元素的嵌套结构设置条件。它们在IntelliJ平台中的两个主要应用是：

- 为自定义语言实现[自动完成贡献者](https://plugins.jetbrains.com/docs/intellij/completion-contributor.html)时指定自动完成应发生的位置。
- 指定PSI元素，通过PSI参考贡献者提供进一步参考。

&emsp;&emsp;然而，插件作者很少直接实现[ElementPattern](https://github.com/JetBrains/intellij-community/blob/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/ElementPattern.java)接口。相反，我们建议使用IntelliJ平台提供的高级模式类：

| 类                                                           | 主要内容                                                     | 值得注意的示例                                               |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| [`StandardPatterns`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/StandardPatterns.java) | 字符串和char模式的工厂（见下文）；逻辑操作，如and, or, not   | [`LogbackReferenceContributor`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/plugins/groovy/src/org/jetbrains/plugins/groovy/ext/logback/LogbackReferenceContributor.kt), [`RegExpCompletionContributor`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/RegExpSupport/src/org/intellij/lang/regexp/RegExpCompletionContributor.java) |
| [`PlatformPatterns`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/PlatformPatterns.java) | PSI、IElement和VirtualFile模式的工厂                         | [`FxmlReferencesContributor`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/plugins/javaFX/src/org/jetbrains/plugins/javaFX/fxml/refs/FxmlReferencesContributor.java), [`PyDataclassCompletionContributor`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/python/python-psi-impl/src/com/jetbrains/python/codeInsight/completion/PyDataclassCompletionContributor.kt) |
| [`PsiElementPattern`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/PsiElementPattern.java) | PSI的模式；对于子节点、父节点或相邻叶子的检查。              | [`XmlCompletionContributor`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/xml/impl/src/com/intellij/codeInsight/completion/XmlCompletionContributor.java) |
| [`CollectionPattern`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/CollectionPattern.java) | 过滤和检查模式集合；主要用于为其他高级模式类提供功能。       | [`PsiElementPattern`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/PsiElementPattern.java) |
| [`TreeElementPattern`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/TreeElementPattern.java) | 用于检查(PSI)树结构的模式                                    | [`PyMetaClassCompletionContributor`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/python/python-psi-impl/src/com/jetbrains/python/codeInsight/completion/PyMetaClassCompletionContributor.java) |
| [`StringPattern`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/StringPattern.java) | 检查字符串是否匹配，长度是否符合特定要求，是否以特定的开头或结尾，或者是否属于字符串集合中的一个。 | [`AbstractGradleCompletionContributor`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/plugins/gradle/java/src/codeInsight/AbstractGradleCompletionContributor.kt) |
| [`CharPattern`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/core-api/src/com/intellij/patterns/CharPattern.java) | 检查字符是否为空格、数字或Java标识符的部分。                 | [`CompletionUtil`](https://github.com/JetBrains/intellij-community/tree/idea/231.8109.175/platform/analysis-impl/src/com/intellij/codeInsight/completion/CompletionUtil.java) |

