# 什么是Java飞行记录

&emsp;&emsp;Java Flight Recorder (JFR) 是一项商业功能。您可以在开发人员的台式机/笔记本电脑上免费使用，也可以在测试、开发和生产环境中出于评估目的使用。但是，要在生产服务器上启用 JFR，您需要获得商业许可。在 JDK 上出于其他目的使用 JMC UI 不需要商业许可证。有关 JFR 商业功能和可用性的详细信息，请参阅 [Oracle Java SE Subscriptions](https://www.oracle.com/java/java-se-subscription/)。

&emsp;&emsp;有关创建飞行记录的详细信息，请参阅[如何制作飞行记录](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr004.html#BABJJEEE)。

&emsp;&emsp;Java Flight Recorder记录了关于java运行时和在java运行时中运行的Java应用程序的详细信息。记录过程的开销很小。数据记录为带有时间戳的数据点，称为事件。典型事件包括线程等待锁、垃圾回收、定期CPU使用数据等。

&emsp;&emsp;创建飞行记录时，您可以选择应保存的事件。这称为记录模板。有些模板只保存非常基本的事件，对性能几乎没有影响。其他模板可能会带来轻微的性能开销，还可能触发GC以收集额外信息。一般来说，很少会看到超过几个百分比的开销。

&emsp;&emsp;飞行记录可用于调试从性能问题到内存泄漏或严重锁争用等各种问题。

&emsp;&emsp;以下主题介绍了制作Java飞行记录的记录类型。

##### 记录类型

&emsp;&emsp;以下是两种类型的飞行记录--连续记录和剖面记录。

- 连续记录 - 连续记录是一种始终保持的记录，例如保存过去6个小时的数据。如果您的应用程序遇到任何问题，您可以转储过去一小时的数据，查看问题发生时的情况。
  - 连续记录的默认设置是使用开销极低的记录配置文件。该配置文件不会获得堆统计或分配剖析，但仍会收集大量有用数据。
  - 连续的记录非常适合始终运行，在调试很少发生的问题时非常有帮助。可以使用jcmd或JMC手动转储记录。您也可以在JMC中设置一个触发器，当满足某些特定条件时转储飞行记录。
- 剖面记录 - 剖析记录是一种打开、运行一定时间后停止的记录。通常，剖析记录启用的事件较多，对性能的影响可能稍大。开启的事件可根据您对剖析记录的使用进行修改。剖析记录的典型用例如下：
  - 说明运行最多的方法和创建最多对象的位置。
  - 查找使用越来越多堆的类，这表明存在内存泄漏。
  - 寻找同步导致的瓶颈以及更多此类用例。

&emsp;&emsp;剖析记录将提供大量信息；即使您不是在排除特定问题。剖析记录将为您提供一个非常好的应用程序视图，并可帮助您找到任何瓶颈或需要改进的地方。

> 注意：
>
> 典型的开销仅为2%左右，因此您完全可以在生产环境中运行剖析记录（这是JFR的主要用例之一），除非您对性能或延迟极为敏感。