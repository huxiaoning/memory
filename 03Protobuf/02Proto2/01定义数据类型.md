## 定义数据类型

下面是一个简单的例子

定义一个请求消息格式，

请求有三个参数：

- 查询字符串
- 页码
- 每面结果数量

```protobuf
message SearchRequest {
  required string query = 1;
  optional int32 page_number = 2;
  optional int32 result_per_page = 3;
}
```

`SearchRequest`消息体定义了三个字段(键值对)。

对于要包含在此类型的消息中的每一条数据，都有一条。

每个字段都有一个名称和类型。

### 指定字段类型

在上面的例子中，所有的字段都是标量，两个整数类型(`page_number`和`result_per_page`)和一个字符串类型(`query`)。

你也可以定义组合类型字段，包括枚举和其他消息类型。

### 分配字段编号

消息定义中的每个字段都有一个唯一的编号。

这些数字用于标识消息二进制格式中的字段。

如果你定义的消息类型已经在使用了，就不应该改变他们了。（传输的双方应该一起改变。）

请注意，1到15范围内的字段号需要一个字节来编码，包括字段编号和字段类型。(在后面的编码章节中可以发现更多空间占用的内容)。

16到2047范围内的字段号需要两个字节。

因此，应该为非常频繁出现的消息元素保留字段编号1到15。

请记住为将来可能添加的频繁出现的元素留出一些空间。

可以指定的最小字段号是1，最大的是229<sup>-1</sup>，即536870911。

不可以使用19000(`FieldDescriptor::kFirstReservedNumber`)到19999(`FieldDescriptor::kLastReservedNumber`)之间的数字作为字段号。它们是`ProtoBuf`实现时使用的保留字段号。如果你在`.proto`文件中使用`ProtoBuf`保留字段号，`Protoc`编译器会抱怨。

同样，不能使用任何以前保留的字段号。

### 指定字段规则

可以指定消息字段为以下之一：

`required` - 必须赋一个值

`optional` - 0~1个值（可传可不传）

`repeated` - 0~多个值(数组、集合)

出于历史原因，`repeated` 的数字类型不能被高效的编码，新代码应该指定`[packed=true]`选项，以获得更高效的编码。

```protobuf
repeated int32 samples = 4 [packed=true];
```

你将在`ProtoBuf`编码那一章发现关于`packed`的更多内容。

将一个字段标记为`required`时要非常小心：

在某些情况下，你希望可以不对一个`required` 字段赋值，再将`required` 字段修改为`optional` 字段是有问题的。

因为现在的读取消息的程序，发现在`required`字段没有赋值是不完整的消息，它可能会拒绝处理或丢弃消息。

你应该考虑为`Protobuf`编写一个特定的验证程序。

