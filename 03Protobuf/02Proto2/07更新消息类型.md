## 更新消息类型

如果现有的消息类型不再满足您的所有需要（例如，您希望消息格式有一个额外的字段），但是您仍然希望使用用旧格式创建的代码，不要担心！在不破坏任何现有代码的情况下更新消息类型非常简单。记住以下规则：

- 不要更改任何现有字段的字段号。
- 新增的字段应该是`optional`或`repeated`。这意味着使用“旧”消息格式的代码序列化的任何消息都可以由新生成的代码进行解析，因为它们不会缺少任何必需的元素。您应该为这些元素设置合理的默认值，以便新代码可以正确地与旧代码生成的消息交互。类似地，由新代码创建的消息也可以由旧代码解析：旧二进制文件在解析时忽略新字段。但是，未知字段不会被丢弃，并且如果消息稍后被序列化，则未知字段也会随之被序列化–因此，如果消息传递给新代码，则新字段仍然可用。
- 非`required`字段可以转换为扩展（下面会有解释），反之亦然，只要类型和字段号保持不变。
- `int32`、`uint32`、`int64`、`uint64`和`bool`都是兼容的—这意味着您可以将字段从一种类型更改为另一种类型，而不会破坏向前或向后的兼容性。如果从不适合于相应类型的线中解析一个数，则将获得与在C++中将该数转换为该类型的相同效果（例如，如果64位数字被读取为一个`int32`，则它将被截断到32位）。