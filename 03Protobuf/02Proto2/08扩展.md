## 扩展

扩展允许您声明消息中的一系列字段号可用于第三方扩展。

扩展是原`.proto`文件中未定义的字段的占位符。

这允许其他`.proto`文件通过定义具有这些字段编号的部分或所有字段的类型来添加到消息定义中。

例如：`a.proto`

```protobuf
// 服务器写下的协议
message Foo {
  // ...
  extensions 100 to 199;
}
```

意思是，`Foo`中的100到199的字符号是为扩展预留的。

其他用户可以在他自已的`.proto`文件中向`Foo`中添加新的字段，这要求他的`.proto`文件要引入你的`.proto`文件(包含`Foo`)，并且使用你预留的字段号。例如：`b.proto`

```protobuf
import "a.proto"

// 服务器添加的扩展
extend Foo {
  optional int32 bar = 126;
}
```

这样就在`b.proto`中通过字段号126向`a.proto`中添加了一个`bar`字段。

```C++
// C++ 服务器设置扩展值 (Java也类似)
Foo foo;
foo.SetExtension(bar, 15);
```



客户端如何读取这个值呢？

`protobuf`生成的`Foo`类中定义了几个模板访问方法：

```java
HasExtension();
ClearExtension();
GetExtension();
MutableExtension();
AddExtension();
```

它们都具有与正常字段的相应生成访问器匹配的语义。有关使用扩展的更多信息，请参阅所选语言的生成代码参考。

请注意：扩展可以是任何字段类型，包括消息类型，但不能是`oneof`或`map`之一。





