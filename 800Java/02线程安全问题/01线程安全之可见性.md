# 线程安全之可见性



### Java内存模型区别于JVM运行时数据区

##### JVM运行时数据区

- 线程共享部分(所有线程能访问这块内存数据，随虚拟机或者GC而创建和销毁)
  - 方法区
  - 堆内存
- 线程独占部分(每个线程都会有它独立的空间，随线程生命周期而创建和销毁)
  - 虚拟机栈
  - 本地方法栈
  - 程序计数器



##### 区别

- Java内存模型由《Java语言规范》定义。
- JVM运行时数据区由《Java虚拟机规范》定义。



所以**Java内存模型**说的是**语法层面**的内容。



### 初看Java内存模型

- 前面章节中的大部分讨论仅涉及代码的行为，即一次执行单个语句或表达式，即通过单个线程来执行。Java虚拟机可以同时支持多个执行线程，若未正确同步，线程的行为可能会出现混淆和违反直觉。
- 本章描述了**多线程程序的语义**；它包含了，**当多个线程修改了共享内存中的值时，应该读取到哪个值的规则**。由于这部分规范类似于不同硬件体系结构的内存模型，因此这些语义称为Java编程语言内存模型。
- 这些语义**没有规定如何**执行多线程程序。相反，它们描述了允许多线程程序的**合法行为**。

​																																																						-- 《Java语言规范》

### 多线程中的问题

- 所见非所得
- 无法肉眼去检测程序的准确性
- 不同的运行平台有不同的表现
- 错误很难重现

