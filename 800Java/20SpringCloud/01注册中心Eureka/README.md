# 注册中心Eureka

### 什么是服务注册中心

服务注册中心是服务实现服务化管理的核心组件,类似于目录服务的作用,主要用来 存储服务信息，譬如提供者 `url` 串、路由信息等。

服务注册中心是 `SOA` 架构中最基础的设 施之一。



###  服务注册中心的作用

- 服务发现
- 服务注册

`QQ`群的群主相当于一个注册中心。



### 常见的注册中心有哪些

- `Dubbo` 的注册中心 `Zookeeper`
- `Sringcloud` 的注册中心 `Eureka`



### 服务注册中心解决了什么问题

- 治理服务：服务管理。
- 治理服务：服务的依赖关系管理。



### Eureka注册中心

`Eureka` 是 `Netflix` 开发的服务发现组件，本身是一个基于 `REST` 的服务。`Spring Cloud` 将它集成在其子项目 `spring-cloud-netflix` 中，以实现 `Spring Cloud` 的服务注册与发现，同时 还提供了负载均衡、故障转移等能力。



###  Eureka 注册中心三种角色

- Eureka Server
  - 通过 Register、Get、Renew 等接口提供服务的注册和发现。
- Application Service (Service Provide)
  - 服务提供方
  - 把自身的服务实例注册到 Eureka Server 中
- Application Client (Service Consumer)
  - 服务调用方
  - 通过 Eureka Server 获取服务列表，消费服务

![](https://github.com/Netflix/eureka/raw/master/images/eureka_architecture.png)

- Register(服务注册)：把自己的 IP 和端口注册给 Eureka。 
- Renew(服务续约)：发送心跳包，每 30 秒发送一次。告诉 Eureka 自己还活着。 
- Cancel(服务下线)：当 provider 关闭时会向 Eureka 发送消息，把自己从服务列表中删除。防 止 consumer 调用到不存在的服务。 
- Get Registry(获取服务注册列表)：获取其他服务列表。 
- Replicate(集群中数据同步)：eureka 集群中的数据复制与同步。 
- Make Remote Call(远程调用)：完成服务的远程调用。





### 分布式`CAP`定理

CAP 原则又称 CAP 定理，指的是在一个分布式系统中，

- Consistency（一致性）、 
- Availability（可用性）、
- Partition tolerance（分区容错性），

三者不可兼得。

 CAP 由 Eric Brewer 在 2000 年 PODC 会议上提出。该猜想在提出两年后被证明成 立，成为我们熟知的 CAP定理。

|                                   |                                                              |      |
| --------------------------------- | ------------------------------------------------------------ | ---- |
| 数据一致性 (Consistency)          | 也叫做数据原子性 系统在执行某项操作后仍然处于一致的状态。在分布式系统 中，更新操作执行成功后所有的用户都应该读到最新的值， 这样的系统被认为是具有强一致性的。等同于所有节点访问 同一份最新的数据副本。 |      |
| 服务可用性 (Availablity)          | 每一个操作总是能够在一定的时间内返回结果，这里需 要注意的是"一定时间内"和"返回结果"。一定时间内指的是， 在可以容忍的范围内返回结果，结果可以是成功或者是失败。 |      |
| 分区容错性 (Partition-torlerance) | 在网络分区的情况下，被分隔的节点仍能正常对外提供 服务(分布式集群，数据被分布存储在不同的服务器上，无论 什么情况，服务器都能正常被访问) |      |



|            | 定律：任何分布式系统只可同时满足二点，没法三者兼顾。         |      |
| ---------- | ------------------------------------------------------------ | ---- |
| CA，放弃 P | 如果想避免分区容错性问题的发生，一种做法是将所有 的数据(与事务相关的)都放在一台机器上。虽然无法 100%保 证系统不会出错，单不会碰到由分区带来的负面效果。当然 这个选择会严重的影响系统的扩展性。 |      |
| CP，放弃 A | 相对于放弃"分区容错性"来说，其反面就是放弃可用性。 一旦遇到分区容错故障，那么受到影响的服务需要等待一定 时间，因此在等待时间内系统无法对外提供服务。 |      |
| AP，放弃 C | 这里所说的放弃一致性，并不是完全放弃数据一致性， 而是放弃数据的强一致性，而保留数据的最终一致性。以网 络购物为例，对只剩下一件库存的商品，如果同时接受了两 个订单，那么较晚的订单将被告知商品告罄。 |      |



###  Zookeeper 与 Eureka 的区别



| 对比项                | Zookeeper  | Eureka      |                                                              |
| --------------------- | ---------- | ----------- | ------------------------------------------------------------ |
| CAP                   | CP         | AP          |                                                              |
| Dubbo 集成            | 已支持     | -           |                                                              |
| Spring Cloud 集成     | 已支持     | 已支持      |                                                              |
| kv 服务               | 支持       | -           | ZK 支持数 据存储，eureka 不支持                              |
| 使用接口(多语言能 力) | 提供客户端 | http 多语言 | ZK 的跨语 言支持比较弱                                       |
| watch 支持            | 支持       | 支持        | 什么是 Watch 支持？ 就是客户单 监听服务端的 变化情况。 zk 通过订阅监 听来实现 eureka 通过轮 询的方式来实 现 |
| 集群监控              | -          | metrics     | metrics， 运维者可以收 集并报警这些 度量信息达到 监控目的    |

