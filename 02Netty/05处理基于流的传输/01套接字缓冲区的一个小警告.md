## 套接字缓冲区的一个小警告

在基于流的传输（如`TCP/IP`）中，接收的数据存储在套接字接收缓冲区中。

不幸的是，基于流的传输的缓冲区不是数据包队列而是字节队列。

这意味着，即使您将两条消息作为两个独立的数据包发送，操作系统也不会将它们视为两条消息，而只是一堆字节。

因此，无法保证您所读的内容与远程对等方所写的内容完全一致。

例如，假设操作系统的TCP/IP堆栈已接收到三个数据包：

![image-20210123222852015](https://raw.githubusercontent.com/huxiaoning/img/master/20210123222853.png)

由于基于流的协议的这一一般特性，在应用程序中很有可能以以下碎片形式读取它们：

![image-20210123222955856](https://raw.githubusercontent.com/huxiaoning/img/master/20210123222957.png)

因此，接收部分，不管是服务器端还是客户端，都应该将接收到的数据碎片整理成一个或多个应用程序逻辑可以容易理解的有意义的帧。在上述示例的情况下，接收到的数据应该像以下那样被帧化：

![image-20210123223102036](https://raw.githubusercontent.com/huxiaoning/img/master/20210123223134.png)

