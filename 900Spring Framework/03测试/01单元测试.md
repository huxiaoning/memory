# 单元测试

<br>

依赖注入应该使你的代码对容器的依赖程度低于使用传统的 `Java EE` 开发。

构成应用程序的 `POJO` 应该可以在 `JUnit` 中进行测试或 `TestNG` 测试，使用 `new` 运算符简单地实例化对象，不使用`Spring `或任何其他容器。

你可以使用`mock`对象（结合其他有价值的测试技术）来隔离(容器)测试您的代码。

如果遵循 Spring 的体系结构建议，则生成的干净分层，并且代码库的组件化将有助于更轻松地进行单元测试。

例如，你可以通过存根或模拟`DAO`或`Repository`接口，不需要真正的访问持久层数据，来测试service层。

<br>

真正的单元测试通常运行得非常快，因为没有要设置的运行时基础设施。

强调真正的单元测试作为开发方法的一部分将提高您的生产力。

对于某些单元测试场景，`Spring Framework` 提供了以下模拟对象和测试支持类。

## 14.1 模拟对象

### 环境 Environment

`org.springframework.mock.env`包中包含有`Environment`和`PropertySource`抽象的模拟实现。

`MockEnvironmen` 和 `MockPropertySource`

### `JNDI`

`org.springframework.mock.jndi `   

### `Servlet API`

### `Portlet API`

## 14.2 单元测试支持类

### 通用测试工具

`org.springframework.test.util`包包含几个通用的实用程序供单元测试和集成测试使用。

`ReflectionTestUtils` 是基于反射的实用方法的集合。

在以下场景可能使用用到`ReflectionTestUtils` 中定义的方法：

- 改变常量的值
- 为非public字段设值
- 调用非public的setter方法
- 调用非public配置或生命周期回调方法

如测试涉及如下用例的应用程序代码：

- `ORM`框架，如`JPA`和`Hibernate`，允许私有或受保护的字段访问，而不是域实体中属性的公共setter方法。
- `Spring`对注释的支持，如`@Autowired`、`@Inject`和`@Resource`，它们提供了专用或受保护字段、setter方法和配置方法的依赖项注入。
- 对生命周期回调方法使用`@PostConstruct`和@`PreDestroy`等注释。

<br>

`AopTestUtils` 是 `AOP` 相关实用方法的集合。

这些方法可以用来获得隐藏在一个或多个 Spring 代理后面的底层目标对象的引用。

例如，如果您使用 `EasyMock` 或 `Mockito` 之类的库将 `bean` 配置为动态模拟，并且`mock` 包含在 `Spring` 代理中，你可能需要直接访问底层 `mock` 以便对其配置期望并执行验证。



## `Spring MVC`

`org.springframework.test.web` 包包含 `ModelAndViewAssert`，你可以与 `JUnit`、`TestNG` 或任何其他测试框架结合使用，用于处理 `Spring MVC ModelAndView` 对象 的单元测试。

### `Spring MVC Constroller`的单元测试

```
To unit test your Spring MVC Controllers as POJOs, use ModelAndViewAssert combined
with MockHttpServletRequest, MockHttpSession, and so on from Spring’s Servlet API
mocks. 
For thorough integration testing of your Spring MVC and REST Controllers in
conjunction with your WebApplicationContext configuration for Spring MVC, use the Spring
MVC Test Framework instead.
```



<br>

